<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>java多线程总结 | WarpTens</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;多线程程序在较低的层次上拓展了多任务的概念:一个程序同时执行多个任务.通常,每个任务被称为一个线程,它是线程控制的简称.可以同时运行一个以上线程的程序通常称为多线程程序.&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;那么,多进程与多线程有哪些区别呢?本质的区别在于每个进程有自己的一套变量,而多线程共享数据.这听起来似乎有些风险,但是也">
<meta property="og:type" content="article">
<meta property="og:title" content="java多线程总结">
<meta property="og:url" content="http://yoursite.com/2015/12/12/javaMultiThread/index.html">
<meta property="og:site_name" content="WarpTens">
<meta property="og:description" content="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;多线程程序在较低的层次上拓展了多任务的概念:一个程序同时执行多个任务.通常,每个任务被称为一个线程,它是线程控制的简称.可以同时运行一个以上线程的程序通常称为多线程程序.&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;那么,多进程与多线程有哪些区别呢?本质的区别在于每个进程有自己的一套变量,而多线程共享数据.这听起来似乎有些风险,但是也">
<meta property="og:updated_time" content="2016-04-14T01:42:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="java多线程总结">
<meta name="twitter:description" content="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;多线程程序在较低的层次上拓展了多任务的概念:一个程序同时执行多个任务.通常,每个任务被称为一个线程,它是线程控制的简称.可以同时运行一个以上线程的程序通常称为多线程程序.&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;那么,多进程与多线程有哪些区别呢?本质的区别在于每个进程有自己的一套变量,而多线程共享数据.这听起来似乎有些风险,但是也">
   
  
    <link rel="alternative" href="/atom.xml" title="WarpTens" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://avatar.csdn.net/0/6/8/1_warptens.jpg?1481643481559" class="js-avatar">
			
			
		</a>

		<hgroup>
		  <a id="follow" 
        href='
          
    javascript:(
    /*
     * Copyright (C) 2015 Rocko (http://rocko.xyz) <rocko.zxp@gmail.com>
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *      http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
    function go() {
    
    function c() {
        var e = document.createElement("link");
        e.setAttribute("type", "text/css");
        e.setAttribute("rel", "stylesheet");
        e.setAttribute("href", f);
        e.setAttribute("class", l);
        document.body.appendChild(e)
    }
 
    function h() {
        var e = document.getElementsByClassName(l);
        for (var t = 0; t < e.length; t++) {
            document.body.removeChild(e[t])
        }
    }
 
    function p() {
        var e = document.createElement("div");
        e.setAttribute("class", a);
        document.body.appendChild(e);
        setTimeout(function() {
            document.body.removeChild(e)
        }, 100)
    }
 
    function d(e) {
        return {
            height : e.offsetHeight,
            width : e.offsetWidth
        }
    }
 
    function v(i) {
        var s = d(i);
        return s.height > e && s.height < n && s.width > t && s.width < r
    }
 
    function m(e) {
        var t = e;
        var n = 0;
        while (!!t) {
            n += t.offsetTop;
            t = t.offsetParent
        }
        return n
    }
 
    function g() {
        var e = document.documentElement;
        if (!!window.innerWidth) {
            return window.innerHeight
        } else if (e && !isNaN(e.clientHeight)) {
            return e.clientHeight
        }
        return 0
    }
 
    function y() {
        if (window.pageYOffset) {
            return window.pageYOffset
        }
        return Math.max(document.documentElement.scrollTop, document.body.scrollTop)
    }
 
    function E(e) {
        var t = m(e);
        return t >= w && t <= b + w
    }
 
    var songs = [
                "http://7xoiki.com1.z0.glb.clouddn.com/Music-Fashion_Show.mp3",
                "http://7xoiki.com1.z0.glb.clouddn.com/Music-Wake-Live.mp3",
                "http://7xoiki.com1.z0.glb.clouddn.com/Music-outside.mp3",
                "http://7xoiki.com1.z0.glb.clouddn.com/Music-sunburst.mp3"
    ];

    function S() {
        var e = document.getElementById("audio_element_id");
        if(e != null){
            var index = parseInt(e.getAttribute("curSongIndex"));
            if(index > songs.length - 2) {
                index = 0;
            } else {
                index++;
            }
            e.setAttribute("curSongIndex", index);
            N();
        }

        e.src = i;
        e.play()
    }
 
    function x(e) {
        e.className += " " + s + " " + o
    }
 
    function T(e) {
        e.className += " " + s + " " + u[Math.floor(Math.random() * u.length)]
    }
 
    function N() {
        var e = document.getElementsByClassName(s);
        var t = new RegExp("\\b" + s + "\\b");
        for (var n = 0; n < e.length; ) {
            e[n].className = e[n].className.replace(t, "")
        }
    }

    function initAudioEle() {
        var e = document.getElementById("audio_element_id");
        if(e === null){
            e = document.createElement("audio");
            e.setAttribute("class", l);
            e.setAttribute("curSongIndex", 0);
            e.id = "audio_element_id";
            e.loop = false;
            e.bgcolor = 0;
            e.addEventListener("canplay", function() {
            setTimeout(function() {
                x(k)
            }, 500);
            setTimeout(function() {
                N();
                p();
                for (var e = 0; e < O.length; e++) {
                    T(O[e])
                }
            }, 15500)
        }, true);
        e.addEventListener("ended", function() {
            N();
            h();
            go();
        }, true);
        e.innerHTML = " <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p> <p>";
        document.body.appendChild(e);
        }
    }
    
    initAudioEle();
    var e = 30;
    var t = 30;
    var n = 350;
    var r = 350;

    var curSongIndex = parseInt(document.getElementById("audio_element_id").getAttribute("curSongIndex"));
    var i = songs[curSongIndex];
    
    var s = "mw-harlem_shake_me";
    var o = "im_first";
    var u = ["im_drunk", "im_baked", "im_trippin", "im_blown"];
    var a = "mw-strobe_light";

    var f = "http://thereisnospon.com/css.css";
    
    var l = "mw_added_css";
    var b = g();
    var w = y();
    var C = document.getElementsByTagName("*");
    var k = null;
    for (var L = 0; L < C.length; L++) {
        var A = C[L];
        if (v(A)) {
            if (E(A)) {
                k = A;
                break
            }
        }
    }
    if (A === null) {
        console.warn("Could not find a node of the right size. Please try a different page.");
        return
    }
    c();
    S();
    var O = [];
    for (var L = 0; L < C.length; L++) {
        var A = C[L];
        if (v(A)) {
            O.push(A)
        }
    }
    })()
    
        '>
      <i class="fa fa-music"></i> &nbsp High一下 </i></a>
		  <h1 class="header-author"><a href="/">WarpTens</a></h1>

		 
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/gate">传送门</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Thereisnospon" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/2195562155?is_all=1" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/acm/" style="font-size: 15px;">acm</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/cpp/" style="font-size: 20px;">cpp</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/总结/" style="font-size: 10px;">总结</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io/">hexo官网</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://mindhacks.cn/">刘未鹏</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://coolshell.cn/">酷壳</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.kdwycz.com/">kdwycz</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.aemiot.com/">泛叶江湖</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://lattez.host.smartgslb.com/">Lattez</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/mummyding/">MummyDing</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.thereisnospon.com/">Thereisnospon</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://rocko.xyz/">rocko</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">WarpTens</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://avatar.csdn.net/0/6/8/1_warptens.jpg?1481643481559" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">WarpTens</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/gate">传送门</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Thereisnospon" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/2195562155?is_all=1" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-javaMultiThread" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/12/javaMultiThread/" class="article-date">
  	<time datetime="2015-12-12T05:27:30.000Z" itemprop="datePublished">2015-12-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      java多线程总结
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>&nbsp; &nbsp; &nbsp; &nbsp;多线程程序在较低的层次上拓展了多任务的概念:一个程序同时执行多个任务.通常,每个任务被称为一个线程,它是线程控制的简称.可以同时运行一个以上线程的程序通常称为多线程程序.<br>&nbsp; &nbsp; &nbsp; &nbsp;那么,多进程与多线程有哪些区别呢?本质的区别在于每个进程有自己的一套变量,而多线程共享数据.这听起来似乎有些风险,但是也是这样,然而共享变量使得线程间的通信比进程之间的通信更加有效,更容易,此外,在有些操作系统中,与进程相比,线程更轻量级,创建,撤销一个线程比启动一个进程的开销要小的多.<br>&nbsp; &nbsp; &nbsp; &nbsp;在实际应用中,多线程非常有用,例如,一个浏览器可以同时下载几副图片,一个web服务器需要同时处理多个并发的请求,图形用户界面程序用一个独立的线程从宿主环境中收集用户界面的事件.接下来,介绍如何为java应用程序添加多线程能力.</p>
</blockquote>
<ul>
<li>以上引用自:《JAVA 核心技术 卷一 基础知识 》</li>
</ul>
<a id="more"></a>
<h2 id="通过继承自Thread："><a href="#通过继承自Thread：" class="headerlink" title="通过继承自Thread："></a>通过继承自Thread：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> <span class="keyword">extends</span> <span class="title">Thread</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line">    String name;  </span><br><span class="line">    Player(String name)&#123;  </span><br><span class="line">        <span class="keyword">this</span>.name=name;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)  </span><br><span class="line">            System.out.println(name+<span class="string">"正在奔跑中"</span>+i);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">        Player aPlayer=<span class="keyword">new</span> Player(<span class="string">"刘翔"</span>);  </span><br><span class="line">        Player bPlayer=<span class="keyword">new</span> Player(<span class="string">"博尔特"</span>);  </span><br><span class="line">        aPlayer.start();  </span><br><span class="line">        bPlayer.start();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<blockquote><p>运行结果:<br>    刘翔正在奔跑中0<br>    博尔特正在奔跑中0<br>    博尔特正在奔跑中1<br>    博尔特正在奔跑中2<br>    刘翔正在奔跑中1<br>    刘翔正在奔跑中2</p>
</blockquote>
<h2 id="实现Runnable接口"><a href="#实现Runnable接口" class="headerlink" title="实现Runnable接口"></a>实现Runnable接口</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">implements</span> <span class="title">Runnable</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line">    String name;  </span><br><span class="line">    Car(String name)&#123;  </span><br><span class="line">        <span class="keyword">this</span>.name=name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)  </span><br><span class="line">            System.out.println(name+<span class="string">"正在运行中"</span>+i);  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">        Car aCar=<span class="keyword">new</span> Car(<span class="string">"法拉利"</span>);  </span><br><span class="line">        Car bCar=<span class="keyword">new</span> Car(<span class="string">"奔驰"</span>);  </span><br><span class="line">        Thread t1=<span class="keyword">new</span> Thread(aCar);  </span><br><span class="line">        Thread t2=<span class="keyword">new</span> Thread(bCar);  </span><br><span class="line">        t1.start();  </span><br><span class="line">        t2.start();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<blockquote><p>运行结果:<br>    奔驰正在运行中0<br>    法拉利正在运行中0<br>    法拉利正在运行中1<br>    法拉利正在运行中2<br>    奔驰正在运行中1<br>    奔驰正在运行中2</p>
</blockquote>
<h2 id="继承自Thread与实现Runnable接口的区别"><a href="#继承自Thread与实现Runnable接口的区别" class="headerlink" title="继承自Thread与实现Runnable接口的区别"></a>继承自Thread与实现Runnable接口的区别</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shop</span> <span class="keyword">extends</span> <span class="title">Thread</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line">    String name;  </span><br><span class="line">    Shop(String name)&#123;  </span><br><span class="line">        <span class="keyword">this</span>.name=name;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count=<span class="number">3</span>;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)  </span><br><span class="line">            <span class="keyword">if</span>(count&gt;=<span class="number">0</span>)  </span><br><span class="line">                System.out.println(name+<span class="string">"卖出一张票,还剩"</span>+--count);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">          </span><br><span class="line">        Shop aShop=<span class="keyword">new</span> Shop(<span class="string">"窗口1 "</span>);  </span><br><span class="line">        Shop bShop=<span class="keyword">new</span> Shop(<span class="string">"窗口2 "</span>);  </span><br><span class="line">        aShop.start();  </span><br><span class="line">        bShop.start();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<blockquote><p>运行结果:<br>    窗口1 卖出一张票,还剩2<br>    窗口2 卖出一张票,还剩2<br>    窗口1 卖出一张票,还剩1<br>    窗口2 卖出一张票,还剩1<br>    窗口1 卖出一张票,还剩0<br>    窗口2 卖出一张票,还剩0</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shop</span> <span class="keyword">implements</span> <span class="title">Runnable</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count=<span class="number">5</span>;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)  </span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.count&gt;=<span class="number">0</span>)  </span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">"卖出一张票，剩"</span>+count--);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">        Shop shop=<span class="keyword">new</span> Shop();  </span><br><span class="line">        <span class="keyword">new</span> Thread(shop,<span class="string">"窗口一"</span>).start();  </span><br><span class="line">        <span class="keyword">new</span> Thread(shop,<span class="string">"窗口二"</span>).start();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote><p>运行结果:<br>    窗口一卖出一张票，剩5<br>    窗口二卖出一张票，剩4<br>    窗口一卖出一张票，剩3<br>    窗口二卖出一张票，剩2<br>    窗口一卖出一张票，剩1<br>    窗口二卖出一张票，剩0</p>
</blockquote>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<strong> main方法其实也是一个线程。在java中所以的线程都是同时启动的，至于什么时候，哪个先执行，完全看谁先得到CPU的资源。</strong><br>&nbsp; &nbsp; &nbsp; &nbsp; 在java中，每次程序运行至少启动2个线程。一个是<strong>main线程</strong>，一个是<strong>垃圾收集线程</strong>。因为每当使用java命令执行一个类的时候，实际上都会启动一个ＪＶＭ，每一个ｊＶＭ实际在就是在操作系统中启动了一个进程。</p>
<h2 id="线程的强制执行"><a href="#线程的强制执行" class="headerlink" title="线程的强制执行:"></a>线程的强制执行:</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)  </span><br><span class="line">            System.out.println(Thread.currentThread().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">          </span><br><span class="line">        ThreadTest threadTest=<span class="keyword">new</span> ThreadTest();  </span><br><span class="line">        Thread thread=<span class="keyword">new</span> Thread(threadTest,<span class="string">"线程"</span>);  </span><br><span class="line">        System.out.println(<span class="string">"线程是否执行中"</span>+thread.isAlive());  </span><br><span class="line">        thread.start();  </span><br><span class="line">        System.out.println(<span class="string">"线程是否执行中"</span>+thread.isAlive());  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">5</span>;i++)  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">if</span>(i&gt;<span class="number">3</span>)  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">try</span>&#123;  </span><br><span class="line">                    thread.join();  </span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;e.printStackTrace();&#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">            System.out.println(<span class="string">"主线程执行中"</span>+i);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<blockquote><p>运行结果:<br>    线程是否执行中false<br>    线程是否执行中true<br>    主线程执行中1<br>    主线程执行中2<br>    主线程执行中3<br>    线程<br>    线程<br>    线程<br>    主线程执行中4<br>    主线程执行中5</p>
</blockquote>
<h2 id="线程的休眠"><a href="#线程的休眠" class="headerlink" title="线程的休眠:"></a>线程的休眠:</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)  </span><br><span class="line">        &#123;  </span><br><span class="line">            System.out.println(<span class="string">"线程执行中"</span>+i);  </span><br><span class="line">            <span class="keyword">try</span>&#123;  </span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);  </span><br><span class="line">            &#125;<span class="keyword">catch</span>(Exception e)&#123;e.printStackTrace();&#125;  </span><br><span class="line">              </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">        ThreadTest threadTest=<span class="keyword">new</span> ThreadTest();  </span><br><span class="line">        <span class="keyword">new</span> Thread(threadTest).start();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<blockquote><p>运行结果:<br>    线程执行中0<br>    线程执行中1<br>    线程执行中2</p>
</blockquote>
<h2 id="线程中断："><a href="#线程中断：" class="headerlink" title="线程中断："></a>线程中断：</h2><p>&nbsp; &nbsp; &nbsp; &nbsp; 当线程的 run 方法执行完，并由 return 语句返回时，或是在方法中出现了未捕获的异常，线程都会终止，也可以通过 interrupt 方法请求中断线程。<br>&nbsp; &nbsp; &nbsp; &nbsp; 当对线程调用interrupt方法时，线程的中断状态将会置位。每个线程都具有boolean标志，每个线程应当不时的检查这个标志，以判断线程是否中断。<br>如：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(!Thread.currentThread().isInterrupted()&amp;&amp; more word to do)&#123;  </span><br><span class="line">        do mo work;  </span><br><span class="line">    &#125;  </span><br></pre></td></tr></table></figure></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; 但是如果线程阻塞，将无法检测中断状态，这里将会产生 InterruptedException当一个阻塞线程调用 interrupt 方法将会被 InterruptedException 中断。<br>&nbsp; &nbsp; &nbsp; &nbsp; 没有任何语言方面的需求要求一个被中断的线程应该终止，中断线程只是引起它的注意，被中断线程可以决定如何相应中断，甚至处理完异常后继续执行，而不理会中断。更普遍的情况是，线程将简单的将线程中断作为一个终止请求。该类run 方法如：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line">    <span class="keyword">try</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        ...  </span><br><span class="line">        <span class="keyword">while</span>(!Thread.currentThread().isInterrupted()&amp;&amp; more work to do)&#123;  </span><br><span class="line">            do more work;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">catch</span>(InterruptedException e)&#123;  </span><br><span class="line">        <span class="comment">//Thread was interrupted during sleep or wait  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">finally</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        cleanup,<span class="keyword">if</span> required;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//exiting the run method teminates the thread  </span></span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><br>   如果线程在中断状态被置位时调用sleep方法，并不会休眠，而是清除中断状态并且抛出 InterruptedException 异常。<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"执行run方法"</span>);  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Thread.sleep(<span class="number">10000</span>);  </span><br><span class="line">            System.out.print(<span class="string">"线程完成休眠"</span>);  </span><br><span class="line">              </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;  </span><br><span class="line">            System.out.println(<span class="string">"线程休眠被打断"</span>);  </span><br><span class="line">            <span class="keyword">return</span> ;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">finally</span>&#123;  </span><br><span class="line">            System.out.println(<span class="string">"线程状态"</span>+Thread.currentThread().isInterrupted());  </span><br><span class="line">        &#125;  </span><br><span class="line">          </span><br><span class="line">        System.out.println(<span class="string">"线程正常终止"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">        ThreadTest threadTest=<span class="keyword">new</span> ThreadTest();  </span><br><span class="line">        Thread thread=<span class="keyword">new</span> Thread(threadTest);  </span><br><span class="line">        thread.start();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;e.printStackTrace();&#125;  </span><br><span class="line">        thread.interrupt();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></p>
 <blockquote><p>运行结果:<br>    执行run方法<br>    线程休眠被打断<br>    线程状态false</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">interrupt</span><span class="params">()</span>  </span><br><span class="line">    <span class="comment">/*向线程发送中断请求。线程的中断状态设置为true。如果当前线程</span><br><span class="line">    被sleep调用阻塞，将会 抛出 InterruptedException*/</span>  </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">interrupted</span><span class="params">()</span>  </span><br><span class="line">    <span class="comment">//测试当前线程是否为被中断，会产生副作用将当前线程中断状态设置为 false  </span></span><br><span class="line"><span class="keyword">boolean</span> <span class="title">isInterrupted</span><span class="params">()</span> <span class="comment">//测试线程是否被终止，不会改变中断状态  </span></span><br><span class="line"><span class="keyword">static</span> Thread <span class="title">currentThread</span><span class="params">()</span> <span class="comment">//返回当前执行线程的Thread对象  </span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">for</span>(;;)  </span><br><span class="line">            System.out.println(<span class="string">"线程执行中"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">        ThreadTest threadTest=<span class="keyword">new</span> ThreadTest();  </span><br><span class="line">        Thread thread=<span class="keyword">new</span> Thread(threadTest);  </span><br><span class="line">        thread.setDaemon(<span class="keyword">true</span>);  </span><br><span class="line">        thread.start();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>虽然设置成为了死循环，但是程序还是可以运行完成的，因为死循环中的线程操作已经设置在后台运行了。</p>
<h2 id="线程同步："><a href="#线程同步：" class="headerlink" title="线程同步："></a>线程同步：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket=<span class="number">5</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> money=<span class="number">0</span>;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        String name=Thread.currentThread().getName();  </span><br><span class="line">        <span class="keyword">while</span>(ticket&gt;=<span class="number">1</span>)&#123;  </span><br><span class="line">                sell();           </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//sell 部分 进行售票收费操作  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        String name=Thread.currentThread().getName();  </span><br><span class="line">        <span class="keyword">if</span>(ticket&gt;=<span class="number">1</span>)&#123;  </span><br><span class="line">            System.out.println(name+<span class="string">"开始卖票了"</span>);  </span><br><span class="line">            ticket--;  </span><br><span class="line">            <span class="comment">//执行一个无意义的耗时操作，让售票与收费可能不能一次性完成  </span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">1000</span>;j++)  </span><br><span class="line">                Math.sin(j);  </span><br><span class="line">            money++;  </span><br><span class="line">            System.out.println(<span class="string">"ticket = "</span>+ticket+<span class="string">"\t money= "</span>+money);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">        ThreadTest threadTest=<span class="keyword">new</span> ThreadTest();  </span><br><span class="line">        <span class="keyword">new</span> Thread(threadTest,<span class="string">"窗口一"</span>).start();;  </span><br><span class="line">        <span class="keyword">new</span> Thread(threadTest,<span class="string">"窗口二"</span>).start();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<blockquote><p>运行结果：<br>    窗口一开始卖票了<br>    窗口二开始卖票了<br>    ticket = 3<br>    money= 2<br>    ticket = 3<br>    money= 2<br>    窗口二开始卖票了<br>    窗口一开始卖票了<br>    ticket = 1<br>    money= 3<br>    ticket = 1<br>    money= 4<br>    窗口二开始卖票了<br>    窗口一开始卖票了<br>    ticket = -1<br>    money= 5<br>    ticket = -1<br>    money= 6</p>
</blockquote>
<blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; 结果中出现了负数，这是因为线程不同步导致的后果，比如当ticket=1的时候窗口一线程判断条件ticket&gt;=1进入执行sell部分，首先打印出”窗口一开始售票”,然后该部分没有完全结束，这时ticket并没有执行 ticket–部分，所以仍然为1此时可能又轮到窗口二线程执行，判断条件ticket&gt;=1于是又进入了 sell 部分，这时候就可以理解了，在ticket=1的时候，两个线程都 已经进入了sell的部分，自然会发生ticket=-1的情况了。为了能够进行同步，可以通过以下几种方法修改上面的代码：可以使用 使用 <strong>synchronized</strong> 关键字将 sell 方法设置为 同步方法:</p>
</blockquote>
<pre><code>synchronized public void sell(){  
    //more code ...  
}  
</code></pre><p>为类添加一个锁作为成员变量，并将 sell 方法修改，给出部分代码:</p>
<figure class="highlight plain"><figcaption><span>lang: java</span></figcaption><table><tr><td class="code"><pre><span class="line">// more code ...  </span><br><span class="line">private Lock lock=new ReentrantLock();  </span><br><span class="line">    public void sell()&#123;  </span><br><span class="line">        lock.lock();  </span><br><span class="line">        try   </span><br><span class="line">        &#123;  </span><br><span class="line">            if(ticket&gt;=1)&#123;  </span><br><span class="line">                ///more code ...  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;   </span><br><span class="line">        finally  </span><br><span class="line">        &#123;  </span><br><span class="line">            lock.unlock();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">//more code ...   </span><br><span class="line"> </span><br></pre></td></tr></table></figure>
 <blockquote><p>设置同步之后，运行结果:<br>    窗口一开始卖票了<br>    ticket = 4<br>    money= 1<br>    窗口一开始卖票了<br>    ticket = 3<br>    money= 2<br>    窗口二开始卖票了<br>    ticket = 2<br>    money= 3<br>    窗口二开始卖票了<br>    ticket = 1<br>    money= 4<br>    窗口一开始卖票了<br>    ticket = 0<br>    money= 5</p>
</blockquote>
<p> 下面是个银行转账的例子:<br>&nbsp; &nbsp; &nbsp; &nbsp; 程序主要功能是，已有100个账户，并且每个账户都预先有1000元的余额，然后为每个账户开启了一个线程，<br>用于将余额转账到一个随机的账户。<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bank</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> accounts[];  </span><br><span class="line">      </span><br><span class="line">    Bank(<span class="keyword">int</span> n,<span class="keyword">double</span> initMoney)&#123;  </span><br><span class="line">        accounts=<span class="keyword">new</span> <span class="keyword">double</span>[n];  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)  </span><br><span class="line">            accounts[i]=initMoney;  </span><br><span class="line">    &#125;  </span><br><span class="line">   <span class="comment">//从 from 账户 转 amount 元 到账户 to  </span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to ,<span class="keyword">double</span> amount)</span></span>&#123;  </span><br><span class="line">            </span><br><span class="line">       <span class="keyword">if</span>(accounts[from]&lt;amount)<span class="keyword">return</span> ;  </span><br><span class="line">           System.out.print(Thread.currentThread().getName());  </span><br><span class="line">           accounts[from]-=amount;  </span><br><span class="line">           System.out.printf(<span class="string">"%10.2f from %d to %d "</span>, amount,from,to);  </span><br><span class="line">           accounts[to]+=amount;  </span><br><span class="line">           System.out.printf(<span class="string">"Total money =%10.2f\n"</span>,getTotalMoney());  </span><br><span class="line">    &#125;  </span><br><span class="line">   <span class="comment">//计算所有账户余额总和  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getTotalMoney</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">double</span> sum=<span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">double</span> a:accounts)  </span><br><span class="line">            sum+=a;  </span><br><span class="line">        <span class="keyword">return</span> sum;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//获取账户总数量  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> accounts.length;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//获取指定账户余额  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getMoney</span><span class="params">(<span class="keyword">int</span> from)</span></span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> accounts[from];  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br></pre></td></tr></table></figure><br>  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> Bank bank;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> fromAccount;<span class="comment">//当前要转账的账户  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> maxAmount;<span class="comment">//转账最大额  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> DELAY=<span class="number">10</span>;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadTest</span><span class="params">(Bank bank,<span class="keyword">int</span> from,<span class="keyword">double</span> max)</span></span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.bank=bank;  </span><br><span class="line">        fromAccount=from;  </span><br><span class="line">        maxAmount=max;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">try</span>   </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>)  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">int</span> toAccount=(<span class="keyword">int</span>)(bank.getSize()*Math.random());  </span><br><span class="line">                <span class="keyword">double</span> amount=(<span class="keyword">long</span>)(maxAmount*Math.random());  </span><br><span class="line">                bank.transfer(fromAccount, toAccount, amount);  </span><br><span class="line">                Thread.sleep((<span class="keyword">long</span>)(DELAY*Math.random()));  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span></span>&#123;  </span><br><span class="line">          </span><br><span class="line">        Bank bank=<span class="keyword">new</span> Bank(<span class="number">100</span>, <span class="number">1000</span>);  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)  </span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> ThreadTest(bank, i, <span class="number">1000</span>)).start();  </span><br><span class="line">          </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br></pre></td></tr></table></figure><br>&nbsp; &nbsp; &nbsp; &nbsp; 在没有进行同步的情况下，可以看到刚开始的时候，总额度没有什么问题，然而运行到了后期的时候，突然发现账户总额出现了问题，原因上面已经说明，因为转出账户余额减少与转入账户余额增加不是原子操作。<br><blockquote><p>Thread-20     40.00 from 20 to 47 Total money = 100000.00<br>Thread-33    647.00 from 33 to 54 Total money = 100000.00<br>Thread-72    579.00 from 72 to 69 Total money = 100000.00<br>…<br>Thread-31    299.00 from 31 to 8 Total money =  99463.00<br>Thread-98    854.00 from 98 to 6 Total money =  99463.00</p>
</blockquote><br>那可以通过增加锁的方式设置临界区,并修改 transfer方法:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="comment">//more code ...  </span></span><br><span class="line"><span class="keyword">private</span> Lock lock=<span class="keyword">new</span> ReentrantLock();  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to ,<span class="keyword">double</span> amount)</span></span>&#123;  </span><br><span class="line">      lock.lock();  </span><br><span class="line">      <span class="keyword">try</span>   </span><br><span class="line">      &#123;  </span><br><span class="line">          <span class="keyword">if</span>(accounts[from]&lt;amount)<span class="keyword">return</span> ;  </span><br><span class="line">          <span class="comment">//more code...  </span></span><br><span class="line">      &#125;   </span><br><span class="line">      <span class="keyword">finally</span>  </span><br><span class="line">      &#123;  </span><br><span class="line">          lock.unlock();  </span><br><span class="line">      &#125;    </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//more code ...  </span></span><br></pre></td></tr></table></figure>
<p>&nbsp; &nbsp; &nbsp; &nbsp;但是有时线程在进入临界区之后，发现还需要满足条件才能执行。就需要设置一个条件来管理那些已经获得了锁却不能进行有效工作的进程.但是如果只是单纯的进行这样的操作</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(bank.getMoney(fromAccount)&gt;=amount)  </span><br><span class="line">        transfer(fromAccount,toAccount,amount);  </span><br></pre></td></tr></table></figure>
<p>&nbsp; &nbsp; &nbsp; &nbsp; 有可能在执行条件判断后，执行 transfer 方法前 线程就已经中断了 而如果将 transfer 方法修改为这样，如果当获得了锁的进程中的余额不足时，将会一直等待其他账户将余额转入，而因为已经获得了此锁，所以其它账户没有进行余额操作的机会.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to ,<span class="keyword">double</span> amount)</span></span>&#123;  </span><br><span class="line">      lock.lock();  </span><br><span class="line">      <span class="keyword">try</span>   </span><br><span class="line">      &#123;  </span><br><span class="line">          <span class="keyword">while</span>(accounts[from]&lt;amount);  </span><br><span class="line">          <span class="comment">//more code...  </span></span><br><span class="line">      &#125;   </span><br><span class="line">      <span class="keyword">finally</span>  </span><br><span class="line">      &#123;  </span><br><span class="line">          lock.unlock();  </span><br><span class="line">      &#125;    </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><br>于是可以使用条件对象，<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="comment">//more code ...  </span></span><br><span class="line"><span class="keyword">private</span> Condition condition;  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Bank</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">double</span> initMoney)</span></span>&#123;  </span><br><span class="line">    condition=lock.newCondition();  </span><br><span class="line">    <span class="comment">//more code ..  </span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//more code ...  </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to ,<span class="keyword">double</span> amount)</span></span>&#123;  </span><br><span class="line">       lock.lock();  </span><br><span class="line">       <span class="keyword">try</span>   </span><br><span class="line">       &#123;  </span><br><span class="line">          <span class="keyword">while</span>(accounts[from]&lt;=amount)  </span><br><span class="line">              condition.await();  </span><br><span class="line">          <span class="comment">//more code ...  </span></span><br><span class="line">           condition.signalAll();  </span><br><span class="line">       &#125;   </span><br><span class="line">       <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;   </span><br><span class="line">       <span class="keyword">finally</span>  </span><br><span class="line">       &#123;  </span><br><span class="line">           lock.unlock();  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line"><span class="comment">//more code ...  </span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; 如果当前账户余额不足，线程阻塞，并且会放弃锁，然后其它线程就有机会继续获得此锁。等待获得锁的线程与调用 awit 方法的线程有本质的区别。一旦一个线程调用 awit 方法，将会进入当前条件的等待集当锁可用时，该线程不能马上解除阻塞，它会继续处于阻塞状态，直到其他线程调用 signalAll 方法。这一方法仅仅只是通知因为该条件进入等待集的所有进程，将这些进程从等待集中移除，他们将被激活，一旦锁继续可用，将回试图重新进入对象，从 awit 犯法调用处返回，获得该锁并从被阻塞的地方继续执行.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="function">Condition <span class="title">newCondition</span><span class="params">()</span>    <span class="comment">//返回一个与该锁相关的条件对象  </span></span><br><span class="line"><span class="keyword">void</span> <span class="title">awit</span><span class="params">()</span>         <span class="comment">//将该线程放到条件的等待集中  </span></span><br><span class="line"><span class="keyword">void</span> <span class="title">signalAll</span><span class="params">()</span>        <span class="comment">//解除该条件等待集中所有线程的阻塞状态  </span></span><br><span class="line"><span class="keyword">void</span> <span class="title">signal</span><span class="params">()</span>           <span class="comment">//解除该条件等待集中某一个线程的阻塞状态  </span></span><br><span class="line"> </span></span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/12/13/javaRegex/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          JAVA正则表达式
        
      </div>
    </a>
  
  
    <a href="/2015/12/11/javaIoStream/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">JAVA-IO流总结</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="javaMultiThread" data-title="java多线程总结" data-url="http://yoursite.com/2015/12/12/javaMultiThread/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 WarpTens
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme extend <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    },
    displayAlign: "left",
    displayIndent: "2em"
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>